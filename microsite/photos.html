<!DOCTYPE html>
<html lang="cs" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>49. PS Kočovníci - Fotogalerie</title>

    <!-- Modern normalize -->
    <link rel="stylesheet" href="https://unpkg.com/modern-normalize/modern-normalize.css">

    <!-- Open Props -->
    <link rel="stylesheet" href="https://unpkg.com/open-props">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Leaflet CSS for interactive map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* Year selector buttons */
        .year-selector {
            display: flex;
            flex-wrap: wrap;
            gap: var(--size-2);
            justify-content: center;
            margin: var(--size-6) 0 var(--size-5) 0;
        }
        
        .year-selector button {
            padding: var(--size-2) var(--size-4);
            background: var(--white);
            color: var(--navy-blue);
            border: 2px solid var(--navy-blue);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: var(--font-size-2);
            font-weight: var(--font-weight-6);
            transition: all var(--transition);
        }
        
        [data-theme="dark"] .year-selector button {
            background: #1e1e1e;
            color: var(--yellow);
            border-color: var(--yellow);
        }
        
        .year-selector button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-2);
        }
        
        .year-selector button.active {
            background: var(--navy-blue);
            color: var(--white);
        }
        
        [data-theme="dark"] .year-selector button.active {
            background: var(--yellow);
            color: var(--black);
        }
        
        /* Preview photos grid */
        .preview-photos {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--size-4);
            margin: var(--size-5) 0;
        }
        
        @media (max-width: 768px) {
            .preview-photos {
                grid-template-columns: 1fr;
            }
        }
        
        .preview-photos img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all var(--transition);
            box-shadow: var(--shadow);
        }
        
        .preview-photos img:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }
        
        #old-gallery-modal {
            border: none;
            border-radius: var(--radius);
            padding: 0;
            width: 95vw;
            height: 95vh;
            max-width: 1200px;
            background: var(--white);
            box-shadow: var(--shadow-6);
            overflow: hidden;
        }
                
        [data-theme="dark"] #old-gallery-modal {
            background: #1e1e1e;
        }
        
        #old-gallery-modal::backdrop {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(var(--size-1));
        }
        
        #old-gallery-modal > div {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }
        
        #old-gallery-modal header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--size-3) var(--size-4);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }
        
        [data-theme="dark"] #old-gallery-modal header {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        
        #old-gallery-modal header h2 {
            margin: 0;
            font-size: var(--font-size-3);
            color: var(--navy-blue);
            text-align: left;
        }
        
        [data-theme="dark"] #old-gallery-modal header h2 {
            color: var(--yellow);
        }
        
        #old-gallery-modal header button {
            background: none;
            font-size: var(--font-size-4);
            padding: var(--size-1) var(--size-2);
            line-height: 1;
        }
        
        #old-gallery-modal .carousel {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--size-5);
            flex-grow: 1;
            min-height: 70vh;
            width: 100%;
        }
        
        #old-gallery-modal .carousel img {
            max-width: 100%;
            max-height: 75vh;
            object-fit: contain;
            border-radius: var(--radius);
            margin: auto;
            display: block;
        }
        
        #old-gallery-modal .carousel button {
            position: absolute;
            z-index: 10;
            background: rgba(0, 0, 0, 0.6);
            width: var(--size-11);
            height: var(--size-11);
            border-radius: var(--radius-round);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #old-gallery-modal .carousel button:hover {
            background: var(--yellow);
            color: var(--black);
        }
        
        #old-gallery-modal .carousel button:first-of-type {
            left: var(--size-4);
        }
        
        #old-gallery-modal .carousel button:last-of-type {
            right: var(--size-4);
        }
        
        .image-counter {
            text-align: center;
            padding: var(--size-2);
            color: var(--light-text);
            font-size: var(--font-size-1);
        }
        
        [data-theme="dark"] .image-counter {
            color: var(--dark-text);
        }

        .loading-text {
            text-align: center;
            padding: var(--size-5);
            color: var(--light-text);
            font-style: italic;
        }

        [data-theme="dark"] .loading-text {
            color: var(--dark-text);
        }
    </style>
</head>

<body>
    <!-- Navigace -->
    <nav>
        <div class="container">
            <a href="index.html">
                <img src="images/logo.png" alt="Logo Kočovníci">
                <span>49. pionýrská skupina Kočovníci</span>
            </a>
            <input type="checkbox" id="nav-toggle" hidden>
            <label for="nav-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </label>
            <menu>
                <li><a href="index.html" aria-current="page">Domů</a></li>
                <li><a href="history.html">Historie</a></li>
                <li><a href="whatwedo.html">O nás</a></li>
                <li><a href="camps.html">Tábory</a></li>
                <li><a href="troops.html">Družiny</a></li>
                <li><a href="photos.html">Fotky</a></li>
                <li><a href="schedule.html">Plán akcí</a></li>
                <li><a href="contact.html">Kontakt</a></li>

                <li>
                    <button onclick="toggleTheme()" title="Přepnout motiv" aria-label="Přepnout světlý/tmavý režim">
                        <svg viewBox="0 0 16 16" width="24" height="24" fill="currentColor">
                            <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z" />
                        </svg>
                    </button>
                </li>
            </menu>
        </div>
    </nav>


    <main class="container">
        <h1>Fotogalerie</h1>

        <section id="rajce">
            <script type="text/javascript" src="https://kocovnici.rajce.idnes.cz/?insert=js" charset="utf-8"></script>
        </section>


        <!-- Nová sekce - Historické fotky podle roků -->
        <section id="old-photos">
            <h2>Historické fotky (2001-2011)</h2>
            <p class="text-center">Vyberte rok a prohlédněte si fotky z dané doby.</p>
            
            <!-- Přepínač roků -->
            <div class="year-selector" id="year-selector">
                <!-- Tlačítka budou vygenerována JavaScriptem -->
            </div>

            <!-- Náhled 3 fotek -->
            <div class="preview-photos" id="preview-photos">
                <p class="loading-text">Načítání fotek...</p>
            </div>
        </section>
    </main>

    <!-- Modal pro základní galerii -->
    <dialog id="gallery-modal">
        <div>
            <header>
                <h2>Prohlížeč fotografií</h2>
                <button onclick="document.getElementById('gallery-modal').close()" aria-label="Zavřít">&times;</button>
            </header>
            <div class="carousel">
                <button onclick="prevImage()" aria-label="Předchozí">&lt;</button>
                <img id="modal-image" src="images/foto1.jpg" alt="Fotografie">
                <button onclick="nextImage()" aria-label="Další">&gt;</button>
            </div>
        </div>
    </dialog>

    <!-- Modal pro historické fotky -->
    <dialog id="old-gallery-modal">
        <div>
            <header>
                <h2 id="old-modal-title">Fotografie</h2>
                <button onclick="document.getElementById('old-gallery-modal').close()" aria-label="Zavřít">&times;</button>
            </header>
            <div class="carousel">
                <button onclick="prevOldImage()" aria-label="Předchozí">&lt;</button>
                <img id="old-modal-image" src="" alt="Historická fotografie">
                <button onclick="nextOldImage()" aria-label="Další">&gt;</button>
            </div>
            <div class="image-counter" id="old-image-counter"></div>
        </div>
    </dialog>
    
    <footer>
        <div class="container" style="position: relative;">
            <p>&copy; 2025 Pionýr, z.s. - 49. pionýrská skupina Kočovníci</p>
            <a href="https://www.pionyr.cz/" target="_blank">
                <img src="images/pionyr.gif" alt="Pionýr">
            </a>
            <a href="dino.html" aria-label="dino game" style="position: absolute; bottom: 10px; right: 10px; width: 50px; height: 50px;"></a>
        </div>
    </footer>

    <!-- Data a skripty -->
    <script src="themeToggle.js"></script>
    <script src="main.js"></script>
    
    <!-- Gallery script pro základní fotky -->
    <script>
        const images = ['images/foto1.jpg', 'images/foto2.jpg', 'images/foto3.jpg', 'images/foto4.jpg', 'images/foto5.jpg', 'images/foto6.jpg'];
        let currentIndex = 0;
        
        function openGallery(index) {
            currentIndex = index;
            document.getElementById('modal-image').src = images[index];
            document.getElementById('gallery-modal').showModal();
        }
        
        function prevImage() {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            document.getElementById('modal-image').src = images[currentIndex];
        }
        
        function nextImage() {
            currentIndex = (currentIndex + 1) % images.length;
            document.getElementById('modal-image').src = images[currentIndex];
        }
        
        // Podpora klávesnice pro základní galerii
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('gallery-modal');
            if (modal.open) {
                if (e.key === 'ArrowLeft') prevImage();
                if (e.key === 'ArrowRight') nextImage();
                if (e.key === 'Escape') modal.close();
            }
        });
    </script>

    <!-- Script pro historické fotky -->
    <script>
        let selectedYear = 2011;
        let allPhotosCache = {};
        let currentYearPhotos = [];
        let currentOldIndex = 0;

        // Funkce pro načtení seznamu fotek z daného roku
        async function loadPhotosForYear(year) {
            if (allPhotosCache[year]) {
                return allPhotosCache[year];
            }

            try {
                // Pokusíme se načíst fotky ze složky
                const photos = [];
                let photoIndex = 1;
                let consecutiveErrors = 0;
                
                // Budeme testovat fotky, dokud nenajdeme 3 po sobě jdoucí chybějící
                while (consecutiveErrors < 3) {
                    const testImg = new Image();
                    const photoPath = `images/old/${year}/foto${photoIndex}.jpg`;
                    
                    const exists = await new Promise((resolve) => {
                        testImg.onload = () => resolve(true);
                        testImg.onerror = () => resolve(false);
                        testImg.src = photoPath;
                    });
                    
                    if (exists) {
                        photos.push(`foto${photoIndex}.jpg`);
                        consecutiveErrors = 0;
                    } else {
                        consecutiveErrors++;
                    }
                    
                    photoIndex++;
                    
                    // Bezpečnostní limit
                    if (photoIndex > 100) break;
                }
                
                allPhotosCache[year] = photos;
                return photos;
            } catch (error) {
                console.error(`Chyba při načítání fotek pro rok ${year}:`, error);
                return [];
            }
        }

        // Náhodný výběr 3 fotek
        function getRandomPhotos(photos, count = 3) {
            if (photos.length <= count) {
                return [...photos];
            }
            
            const shuffled = [...photos].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }

        // Zobrazení 3 náhodných fotek
        async function displayPreviewPhotos(year) {
            const container = document.getElementById('preview-photos');
            container.innerHTML = '<p class="loading-text">Načítání fotek...</p>';
            
            const photos = await loadPhotosForYear(year);
            
            if (photos.length === 0) {
                container.innerHTML = '<p class="loading-text">Pro tento rok nejsou k dispozici žádné fotky.</p>';
                return;
            }
            
            const randomPhotos = getRandomPhotos(photos, 3);
            container.innerHTML = '';
            
            randomPhotos.forEach((photo) => {
                const img = document.createElement('img');
                img.src = `images/old/${year}/${photo}`;
                img.alt = `Fotografie z roku ${year}`;
                img.loading = 'lazy';
                img.onclick = () => openOldGallery(year, photos.indexOf(photo));
                container.appendChild(img);
            });
        }

        // Vytvoření tlačítek pro roky
        function createYearSelector() {
            const container = document.getElementById('year-selector');
            const years = [2011, 2010, 2009, 2008, 2007, 2006, 2005, 2004, 2003, 2002, 2001];
            
            years.forEach(year => {
                const button = document.createElement('button');
                button.textContent = year;
                button.onclick = () => selectYear(year);
                button.setAttribute('data-year', year);
                
                if (year === selectedYear) {
                    button.classList.add('active');
                }
                
                container.appendChild(button);
            });
        }

        // Výběr roku
        async function selectYear(year) {
            selectedYear = year;
            
            // Aktualizace aktivního tlačítka
            document.querySelectorAll('.year-selector button').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.getAttribute('data-year')) === year) {
                    btn.classList.add('active');
                }
            });
            
            // Načtení a zobrazení fotek
            await displayPreviewPhotos(year);
        }

        // Otevření galerie historických fotek
        async function openOldGallery(year, startIndex) {
            const photos = await loadPhotosForYear(year);
            
            if (photos.length === 0) {
                alert('Pro tento rok nejsou k dispozici žádné fotky.');
                return;
            }
            
            currentYearPhotos = photos;
            selectedYear = year;
            currentOldIndex = startIndex;
            
            updateOldModalImage();
            document.getElementById('old-gallery-modal').showModal();
        }

        // Aktualizace obrázku v modalu
        function updateOldModalImage() {
            const photo = currentYearPhotos[currentOldIndex];
            const img = document.getElementById('old-modal-image');
            img.src = `images/old/${selectedYear}/${photo}`;
            
            document.getElementById('old-modal-title').textContent = `Rok ${selectedYear}`;
            document.getElementById('old-image-counter').textContent = 
                `${currentOldIndex + 1} / ${currentYearPhotos.length}`;
        }

        // Předchozí fotka
        function prevOldImage() {
            currentOldIndex = (currentOldIndex - 1 + currentYearPhotos.length) % currentYearPhotos.length;
            updateOldModalImage();
        }

        // Další fotka
        function nextOldImage() {
            currentOldIndex = (currentOldIndex + 1) % currentYearPhotos.length;
            updateOldModalImage();
        }

        // Podpora klávesnice pro historickou galerii
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('old-gallery-modal');
            if (modal.open) {
                if (e.key === 'ArrowLeft') prevOldImage();
                if (e.key === 'ArrowRight') nextOldImage();
                if (e.key === 'Escape') modal.close();
            }
        });

        // Inicializace při načtení stránky
        document.addEventListener('DOMContentLoaded', async () => {
            createYearSelector();
            await displayPreviewPhotos(selectedYear);
        });
    </script>
    <script src="scrollAnimation.js"></script>
</body>

</html>